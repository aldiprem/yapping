<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Deteksi Jempol Stabil</title>
<style>
  body { margin:0; display:flex; justify-content:center; align-items:center; height:100vh; background:#000; }
  canvas, video { position:absolute; }
</style>
</head>
<body>

<video id="video" autoplay playsinline style="transform: scaleX(-1);"></video>
<canvas id="output"></canvas>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('output');
const ctx = canvas.getContext('2d');

let smoothX = null, smoothY = null; // untuk smoothing titik

const hands = new Hands({
  locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
});

hands.setOptions({
  maxNumHands: 1,
  modelComplexity: 1,
  minDetectionConfidence: 0.7,
  minTrackingConfidence: 0.7
});

hands.onResults(onResults);

async function startCamera() {
  const stream = await navigator.mediaDevices.getUserMedia({ video: true });
  video.srcObject = stream;

  video.onloadedmetadata = () => {
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    const camera = new Camera(video, {
      onFrame: async () => { await hands.send({ image: video }); },
      width: video.videoWidth,
      height: video.videoHeight
    });
    camera.start();
  };
}

function onResults(results) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // gambar video di canvas (mirror)
  ctx.save();
  ctx.scale(-1, 1);
  ctx.drawImage(results.image, -canvas.width, 0, canvas.width, canvas.height);
  ctx.restore();

  if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
    const landmarks = results.multiHandLandmarks[0];

    // jempol ujung: index 4 di Mediapipe
    const thumbTip = landmarks[4];
    const x = thumbTip.x * canvas.width;
    const y = thumbTip.y * canvas.height;

    // smoothing (0.3 = lebih lembut, ganti ke 0.5 untuk responsif tapi agak goyang)
    if (smoothX === null) {
      smoothX = x;
      smoothY = y;
    } else {
      smoothX = smoothX + (x - smoothX) * 0.3;
      smoothY = smoothY + (y - smoothY) * 0.3;
    }

    // gambar titik di posisi jempol
    ctx.beginPath();
    ctx.arc(smoothX, smoothY, 10, 0, Math.PI * 2);
    ctx.fillStyle = "red";
    ctx.fill();
  }
}

startCamera();
</script>
</body>
</html>